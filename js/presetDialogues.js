/**
 * 战锤40K - 预设对话库
 * 当AI不可用时使用，丰富多样的预设文本
 */

const PRESETS = {
    // 开场白（多种变体）
    guide: [
        `黑暗中，你睁开双眼，感受到冰冷的金属地板贴着你的肌肤。

你是{class}，帝国最忠诚的战士之一。此刻你身处麦加托普星球——极限战士战团的母星，但这里已经不再是曾经的圣地。

混沌的阴影正在蔓延。兽人的入侵、混沌信徒的渗透、内鬼的背叛...这座星球正处在崩溃的边缘。

你的任务是通过完成各种挑战卡牌来生存，每一步都关乎你的灵魂。

准备好了吗，战士？点击"开始任务"开始你的冒险。`,
        
        `刺眼的光芒消退后，你发现自己躺在一片废墟之中。

作为{class}，你见过太多战场，但麦加托普的沦陷速度远超你的预料。混沌的腐化如同毒液，已经渗透进这个星球的每一个角落。

你的通讯器传来断断续续的信号："...需要...支援...混沌已经..."

你必须振作起来。每一张卡牌任务都是一次考验，每一次选择都可能决定你的命运。

帝国需要你。点击"开始任务"开始行动。`,
        
        `血腥味混合着焦土的气息，这是你对麦加托普最后的记忆。

作为{class}，你曾以为自己是帝国最锋利的武器。但现在，你只是这片废土上的一名幸存者。

混沌的触手无处不在，它们在阴影中窥视，在低语中诱惑。

你的职责是完成卡牌任务，清除威胁，保持理智。混沌值过高意味着堕落，那比死亡更可怕。

深吸一口气，开始吧。点击"开始任务"。`
    ],
    
    // NPC对话（每个NPC多种对话）
    npc: {
        tam: [
            "大人，我昨晚确实在仓库附近巡逻，但什么都没看到。帝皇在上，我对帝国忠心耿耿！",
            "最近营地里弥漫着一股奇怪的味道...像是烧焦的肉，又像是某种化学药剂。大人，您注意到了吗？",
            "我、我真的什么都没看到！求您不要用那种眼神看我...我只是一个小小的士兵...",
            "昨晚我听到仓库那边有动静，像是金属碰撞的声音。但等我赶去时，什么都没有了。",
            "混沌...您是说混沌吗？天哪，我们中间真的有混沌信徒？大人，我发誓我绝不是！",
            "这几天的气氛太诡异了。连呼吸都变得困难...我是说，这里的空气。"
        ],
        carl: [
            "物资清单？等等，我需要核对一下...最近的补给确实出了点问题，但这不是我的错！",
            "我为帝国效力二十年！您怀疑我？好啊，来查啊！我身正不怕影子斜！",
            "最近补给线被切断，上面已经知道了。这次的损失...呃，应该不是我的责任吧？",
            "什么？您说物资短缺？呃...这个嘛...其实是有原因的！您听我解释！",
            "我每天都在努力工作，从早到晚...您看我的黑眼圈，就是最好的证明！",
            "仓库里的情况很复杂...有些事情，您知道了反而不好。相信我，大人。"
        ],
        yuri: [
            "赞美欧姆尼赛亚！机械即是真理，血肉不过是脆弱的躯壳。",
            "这具身躯已经改造了87%，我几乎不再是人类...这是进化的必然！",
            "血肉苦弱，机械飞升。这是我们机械教的真理，您难道不明白吗？",
            "最近的灵能波动很异常...我感受到了某些东西，正在黑暗中窥视。",
            "我的机械义眼能够看到你们看不到的东西...比如灵魂的扭曲。",
            "混沌？哼，混沌不过是另一种形式的能量。关键是能否控制它。"
        ]
    },
    
    // 事件描写（根据类型）
    events: {
        chaos: [
            "营地中弥漫着可疑的气息。你感觉到——不，你确信——有人在暗中监视你。混沌的爪牙可能就隐藏在你身边。",
            "一阵寒意袭来。周围的士兵们看起来都很正常，但你的直觉告诉你：内鬼就在其中。",
            "你的混沌感知在警告你。有什么东西正在靠近——不是物理威胁，而是精神层面的侵蚀。",
            "暗门、暗号、秘密集会...找出混沌信徒的证据就藏在这座营地的某处。",
            "你的脑海中传来低语声。不要听！那是混沌的诱惑...但它似乎在告诉你一些关于内鬼的信息..."
        ],
        faith: [
            "帝皇的圣光照耀着你。在这个混沌蔓延的时代，信仰是最后的盾牌。",
            "你感受到了一股神圣的力量在呼唤你。完成帝皇的旨意，这是你作为战士的使命。",
            "在战锤的轰鸣中，祈祷的声音显得如此微弱。但帝皇听到了——他一直在倾听。",
            "你的信仰正在接受考验。在这个充满诱惑和恐惧的世界，你能否保持对帝皇的忠诚？",
            "圣殿的钟声在远处回响。那是帝国的心脏还在跳动的证明...也是你需要守护的东西。"
        ],
        combat: [
            "远处传来野兽的嚎叫和武器碰撞的声音。敌人就在不远处，你必须准备战斗。",
            "硝烟弥漫，废墟中潜伏着危险。作为帝国战士，你不能退缩！",
            "一支混沌小队正在靠近。他们的装备简陋，但数量众多...这是一场硬仗。",
            "废弃的工事后面，你看到了敌人正在集结。现在是进攻的最佳时机。",
            "血腥味越来越浓。战斗已经开始，你没有选择——要么战斗，要么死亡。"
        ],
        devotion: [
            "在这个残酷的世界，同伴是最珍贵的财富。建立联系，获得追随者。",
            "你注意到一个值得信赖的身影。在这个绝望的环境中，友谊是罕见的奢侈品。",
            "有人在向你求助。这是一个机会——帮助他人，获得追随者的忠诚。",
            "幸存者们需要一个领导者。你是否愿意承担这个责任？",
            "信任是需要培养的。一点小小的善意，可能会换来一个生死与共的伙伴。"
        ]
    },
    
    // 伊莲娜的提示
    elena: {
        card: [
            "这张卡代表你的任务。完成它，你将获得奖励；失败，混沌值会增加。小鬼，好好看看卡牌上的描述！",
            "每张卡都有它的意义。混沌卡需要你找出内鬼，信仰卡需要你保持忠诚，战斗卡需要你展现力量。",
            "卡牌任务有时间限制的！三个回合内必须完成，不然混沌值会增加。记住了吗？",
            "任务分四种难度：简单、普通、困难、极难。越难的任务，奖励越丰厚，但失败的风险也越大。"
        ],
        chaos: [
            "混沌值是你灵魂被侵蚀的程度。超过50，你开始产生幻觉；超过80，审判即将降临；达到100，你将彻底堕落。",
            "保持清醒，小鬼！混沌值过高时，你会看到假线索，做出错误判断。",
            "混沌值可以通过净化仪式降低，或者完成任务来减少。但最关键的是——不要做会导致混沌增加的选择。",
            "注意你的混沌值！如果超过50%，你获得假线索的概率会增加。这是混沌的诡计！"
        ],
        strategy: [
            "先易后难！完成简单任务积累资源和信心，再挑战困难任务。",
            "调查时多收集线索再做决定。盲目投票会害死无辜的人，也会增加你的混沌值。",
            "追随者很有用！战斗追随者提供攻击加成，灵能追随者有特殊能力。",
            "别忘了回合数！每回合建筑都会产出物资，合理利用资源是生存的关键。"
        ],
        general: [
            "你是{class}，帝国的战士。你的目标是完成卡牌任务，在14回合内存活下来。",
            "点击下方按钮进行操作。系统面板有存档、读档、状态查看功能。",
            "伊莲娜随时在这里陪你聊天。有什么不懂的尽管问我，小鬼。",
            "混沌、信仰、战斗、眷属...四种卡牌，四种挑战。理解它们，征服它们！",
            "游戏目标：保持混沌值低于100，坚持14回合。很简单，对吧？"
        ]
    },
    
    // 任务完成评价
    taskSuccess: [
        "干得漂亮！这才是我弟弟/妹妹该有的样子！",
        "任务完成得很出色！帝皇会记住你的功绩。",
        "Nice！我就知道你能做到！继续保持，小鬼。",
        "不错不错~这套操作可以说是行云流水了。",
        "这是你应得的奖励。姐姐为你感到骄傲！",
        "完美！看来你已经开始掌握这个游戏的精髓了。"
    ],
    
    taskFail: [
        "哎...这次失误了。别太在意，下次注意就好。",
        "混沌值增加了...但这不是世界末日。吸取教训，重新出发。",
        "失败了也不要紧。重要的是你还活着，还有机会重来。",
        "小鬼，你是不是走神了？下次集中注意力！",
        "这次运气不好...但混沌不会一直眷顾敌人。相信自己，再试一次！",
        "没关系姐姐不会怪你的。调整策略，我们再来！"
    ]
};

/**
 * 获取随机预设对话
 */
function getPreset(type, subType = null) {
    let pool = [];
    
    if (type === 'guide') {
        pool = PRESETS.guide;
    } else if (type === 'npc' && subType) {
        pool = PRESETS.npc[subType] || [];
    } else if (type === 'events' && subType) {
        pool = PRESETS.events[subType] || [];
    } else if (type === 'elena' && subType) {
        pool = PRESETS.elena[subType] || [];
    } else if (type === 'taskSuccess') {
        pool = PRESETS.taskSuccess;
    } else if (type === 'taskFail') {
        pool = PRESETS.taskFail;
    }
    
    if (pool.length === 0) return '预设文本未找到...';
    
    return pool[Math.floor(Math.random() * pool.length)];
}

/**
 * 格式化预设文本（替换占位符）
 */
function formatPreset(text) {
    const charClass = gameState?.character?.class || '战士';
    return text.replace(/{class}/g, charClass);
}

/**
 * 获取开场白
 */
function getGuideText() {
    return formatPreset(getPreset('guide'));
}

/**
 * 获取NPC对话
 */
function getNPCDialogue(npcId) {
    return getPreset('npc', npcId) || '我没有话说。';
}

/**
 * 获取事件描写
 */
function getEventDescription(cardType) {
    return getPreset('events', cardType) || '任务开始。';
}

/**
 * 获取伊莲娜提示
 */
function getElenaTip(tipType) {
    return formatPreset(getPreset('elena', tipType)) || '姐姐不知道说什么...';
}

/**
 * 获取任务评价
 */
function getTaskEvaluation(success) {
    return getPreset(success ? 'taskSuccess' : 'taskFail');
}

// 导出
window.PRESETS = PRESETS;
window.getPreset = getPreset;
window.formatPreset = formatPreset;
window.getGuideText = getGuideText;
window.getNPCDialogue = getNPCDialogue;
window.getEventDescription = getEventDescription;
window.getElenaTip = getElenaTip;
window.getTaskEvaluation = getTaskEvaluation;
